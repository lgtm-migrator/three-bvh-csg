var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},r={},o=e.parcelRequirefee5;null==o&&((o=function(e){if(e in t)return t[e].exports;if(e in r){var o=r[e];delete r[e];var i={id:e,exports:{}};return t[e]=i,o.call(i.exports,i,i.exports),i.exports}var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){r[e]=t},e.parcelRequirefee5=o);var i=o("ilwiq"),n=o("jiuw3"),a=o("5Rd1x"),s=o("7lx9d"),d=o("kp7Te");const l=new(0,(i=o("ilwiq")).Triangle),u=new(0,i.Vector3);class c{constructor(e){let t=e.geometry;if(!t.isBufferGeometry||3!==t.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){const e=this.positionAttribute,t=this.weightAttribute,r=new Float32Array(e.count/3);for(let o=0;o<e.count;o+=3){let i=1;t&&(i=t.getX(o)+t.getX(o+1)+t.getX(o+2)),l.a.fromBufferAttribute(e,o),l.b.fromBufferAttribute(e,o+1),l.c.fromBufferAttribute(e,o+2),i*=l.getArea(),r[o/3]=i}this.distribution=new Float32Array(e.count/3);let o=0;for(let e=0;e<r.length;e++)o+=r[e],this.distribution[e]=o;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,r){const o=this.distribution[this.distribution.length-1],i=this.binarySearch(this.randomFunction()*o);return this.sampleFace(i,e,t,r)}binarySearch(e){const t=this.distribution;let r=0,o=t.length-1,i=-1;for(;r<=o;){const n=Math.ceil((r+o)/2);if(0===n||t[n-1]<=e&&t[n]>e){i=n;break}e<t[n]?o=n-1:r=n+1}return i}sampleFace(e,t,r,o){let i=this.randomFunction(),n=this.randomFunction();return i+n>1&&(i=1-i,n=1-n),l.a.fromBufferAttribute(this.positionAttribute,3*e),l.b.fromBufferAttribute(this.positionAttribute,3*e+1),l.c.fromBufferAttribute(this.positionAttribute,3*e+2),t.set(0,0,0).addScaledVector(l.a,i).addScaledVector(l.b,n).addScaledVector(l.c,1-(i+n)),void 0!==r&&l.getNormal(r),void 0!==o&&void 0!==this.colorAttribute&&(l.a.fromBufferAttribute(this.colorAttribute,3*e),l.b.fromBufferAttribute(this.colorAttribute,3*e+1),l.c.fromBufferAttribute(this.colorAttribute,3*e+2),u.set(0,0,0).addScaledVector(l.a,i).addScaledVector(l.b,n).addScaledVector(l.c,1-(i+n)),o.r=u.x,o.g=u.y,o.b=u.z),this}}var h=o("4CEV9");const p={operation:h.SUBTRACTION,wireframe:!1,displayBrushes:!1,shadows:!0,useGroups:!0,randomize:()=>{F(),R()}};let f,m,w,b,g,y,S,A,B,M,v,E,T,x=new(0,h.Evaluator);x.attributes=["position","normal"],x.useGroups=!1;const G=new Map;function R(){const e=window.performance.now();let t=A[0];x.useGroups=!1;for(let e=1,r=A.length;e<r;e++){const r=A[e];t=x.evaluate(t,r,h.ADDITION),t.material=B}x.useGroups=p.useGroups,x.evaluate(S,t,p.operation,v),v.material=p.useGroups?v.material.map((e=>G.get(e))):G.get(S.material);const r=window.performance.now()-e;y.innerText=`${r.toFixed(3)}ms`}function F(){for(let e=0;e<A.length;e++){const t=A[e];M.sample(t.position),t.position.applyMatrix4(S.matrixWorld),t.scale.setScalar(i.MathUtils.lerp(.05,.15,Math.random())),t.updateMatrixWorld()}}function O(){requestAnimationFrame(O),E.visible=p.wireframe,S.visible=p.displayBrushes,A.forEach((e=>e.visible=p.displayBrushes)),T.castShadow=p.shadows,f.render(w,m)}!async function(){y=document.getElementById("output"),f=new i.WebGLRenderer({antialias:!0}),f.setPixelRatio(window.devicePixelRatio),f.setSize(window.innerWidth,window.innerHeight),f.setClearColor(1118481,1),f.shadowMap.enabled=!0,f.shadowMap.type=i.PCFSoftShadowMap,f.outputEncoding=i.sRGBEncoding,document.body.appendChild(f.domElement),w=new i.Scene,T=new i.DirectionalLight(16777215,1),T.position.set(1,2,1),w.add(T,new i.AmbientLight(11583173,.1));const e=T.shadow.camera;T.castShadow=!0,T.shadow.mapSize.setScalar(4096),T.shadow.bias=1e-5,T.shadow.normalBias=.01,e.left=e.bottom=-2.5,e.right=e.top=2.5,e.updateProjectionMatrix(),m=new i.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,50),m.position.set(0,.65,2.5),m.far=100,m.updateProjectionMatrix(),b=new(0,a.OrbitControls)(m,f.domElement);const t=new i.Mesh(new i.PlaneBufferGeometry,new i.ShadowMaterial({opacity:.05}));t.material.color.set(14743546).convertSRGBToLinear(),t.rotation.x=-Math.PI/2,t.scale.setScalar(10),t.position.y=-.5,t.receiveShadow=!0,w.add(t);const r=(await(new(0,s.GLTFLoader)).setMeshoptDecoder(d.MeshoptDecoder).loadAsync("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/stanford-bunny/bunny.glb")).scene.children[0].geometry;r.computeVertexNormals(),S=new(0,h.Brush)(r,new i.MeshStandardMaterial),S.position.y=-.5,S.updateMatrixWorld(),S.receiveShadow=!0,w.add(S),B=new i.MeshStandardMaterial,A=[],M=new c(S),M.build();for(let e=0;e<50;e++){const e=new(0,h.Brush)(new i.SphereBufferGeometry(1,15,15),B);e.receiveShadow=!0,w.add(e),A.push(e)}let o;S.material.opacity=.15,S.material.transparent=!0,S.material.depthWrite=!1,S.material.polygonOffset=!0,S.material.polygonOffsetFactor=.1,S.material.polygonOffsetUnits=.1,S.material.side=i.DoubleSide,S.material.premultipliedAlpha=!0,S.material.color.set(14743546).convertSRGBToLinear(),B.opacity=.15,B.transparent=!0,B.depthWrite=!1,B.polygonOffset=!0,B.polygonOffsetFactor=.1,B.polygonOffsetUnits=.1,B.side=i.DoubleSide,B.premultipliedAlpha=!0,B.roughness=.25,B.color.set(5099745).convertSRGBToLinear(),o=S.material.clone(),o.opacity=1,o.transparent=!1,o.depthWrite=!0,G.set(S.material,o),o=B.clone(),o.opacity=1,o.transparent=!1,o.depthWrite=!0,G.set(B,o),v=new i.Mesh(new i.BufferGeometry,new i.MeshStandardMaterial({roughness:.1,flatShading:!1,polygonOffset:!0,polygonOffsetUnits:1,polygonOffsetFactor:1})),v.castShadow=!0,v.receiveShadow=!0,w.add(v),E=new i.Mesh(v.geometry,new i.MeshBasicMaterial({wireframe:!0,color:0,opacity:.15,transparent:!0})),E.material.color.set(5398).convertSRGBToLinear(),w.add(E),g=new(0,n.GUI),g.add(p,"operation",{ADDITION:h.ADDITION,SUBTRACTION:h.SUBTRACTION,INTERSECTION:h.INTERSECTION,DIFFERENCE:h.DIFFERENCE}).onChange((()=>{R()})),g.add(p,"displayBrushes"),g.add(p,"shadows"),g.add(p,"wireframe"),g.add(p,"useGroups").onChange(R),g.add(p,"randomize"),window.addEventListener("resize",(function(){m.aspect=window.innerWidth/window.innerHeight,m.updateProjectionMatrix(),f.setSize(window.innerWidth,window.innerHeight)}),!1),F(),R(),O()}();
//# sourceMappingURL=geometry.11133ed7.js.map
